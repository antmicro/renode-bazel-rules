From 29c1407e19ec9b316316a15560e6033cdcc43824 Mon Sep 17 00:00:00 2001
From: Kamil Rakoczy <krakoczy@antmicro.com>
Date: Fri, 6 Oct 2023 09:45:32 +0200
Subject: [PATCH] Renode: Add BUILD.bazel

Signed-off-by: Kamil Rakoczy <krakoczy@antmicro.com>
---
 src/Plugins/VerilatorPlugin/BUILD.bazel |  72 +++++++++++
 src/Plugins/WiresharkPlugin/BUILD.bazel |  62 ++++++++++
 6 files changed, 423 insertions(+)
 create mode 100644 src/Plugins/VerilatorPlugin/BUILD.bazel
 create mode 100644 src/Plugins/WiresharkPlugin/BUILD.bazel

diff --git a/src/Plugins/VerilatorPlugin/BUILD.bazel b/src/Plugins/VerilatorPlugin/BUILD.bazel
new file mode 100644
index 00000000..c6cfbc92
--- /dev/null
+++ b/src/Plugins/VerilatorPlugin/BUILD.bazel
@@ -0,0 +1,72 @@
+load(
+    "@rules_dotnet//dotnet:defs.bzl",
+    "csharp_library",
+)
+
+package(default_visibility = ["//visibility:public"])
+
+csharp_library(
+    name = "VerilatorPlugin",
+    srcs = [
+     "Connection/IVerilatedPeripheral.cs",
+     "Connection/LibraryVerilatorConnection.cs",
+     "Connection/Protocols/ActionType.cs",
+     "Connection/Protocols/ProtocolMessage.cs",
+     "Connection/SocketVerilatorConnection.cs",
+     "Verilated/Peripherals/BaseDoubleWordVerilatedPeripheral.cs",
+     "Verilated/Peripherals/BaseVerilatedPeripheral.cs",
+     "Verilated/Peripherals/CFUVerilatedPeripheral.cs",
+     "Verilated/Peripherals/VerilatedCPU.cs",
+     "Verilated/Peripherals/VerilatedPeripheral.cs",
+     "Verilated/Peripherals/VerilatedRiscV32.cs",
+     "Verilated/Peripherals/VerilatedRiscV32Registers.cs",
+     "Verilated/Peripherals/VerilatedUART.cs",
+     "VerilatorPlugin.cs",
+    ],
+    internals_visible_to = ["lib_verilatorplugin"],
+    target_frameworks = ["net6.0"],
+    targeting_packs = [
+        "@rules_dotnet_nuget_packages//microsoft.netcore.app.ref",
+    ],
+    deps = [
+        "//src/Infrastructure/src/Emulator/Main:Emulator",
+        "//src/Infrastructure/src/Emulator/Extensions:Extensions",
+        "//src/Infrastructure/src/Emulator/Peripherals:Renode-peripherals",
+        "//src/Infrastructure/src/Emulator/Cores:cores-riscv",
+        "//lib/Migrant/Migrant:Migrant",
+        "//lib/ELFSharp/ELFSharp:ELFSharp",
+        "//lib/Packet.Net/PacketDotNet:PacketDotNet",
+        "//lib/CxxDemangler/CxxDemangler:CxxDemangler",
+        "//lib/AntShell/AntShell:AntShell",
+        "//lib/xwt/Xwt:Xwt",
+        "//lib/BigGustave/src/BigGustave:BigGustave",
+        "//lib/xwt/Xwt.Gtk:XwtGtk",
+        "//lib/termsharp:TermSharp",
+        "@renode-resources//:lucene",
+        "@renode-resources//:IronPython",
+        "@renode-resources//:IronPythonStdLib",
+        "@renode-resources//:IronPythonModules",
+        "@renode-resources//:MicrosoftScripting",
+        "@renode-resources//:MonoLinqExpressions",
+        "@renode-resources//:MonoTextTemplating",
+        "@renode-resources//:Dynamitey",
+        "@resources//system.drawing.common",
+        "@resources//gtksharp",
+        "@resources//atksharp",
+        "@resources//glibsharp",
+        "@resources//cairosharp",
+        "@resources//gdksharp",
+        "@resources//giosharp",
+        "@resources//pangosharp",
+        "@resources//mono.posix.netstandard",
+        "@resources//microsoft.codeanalysis.csharp",
+        "@resources//microsoft.codeanalysis.visualbasic",
+        "@resources//microsoft.codeanalysis.common",
+        "@resources//microsoft.codeanalysis.analyzers",
+        "@resources//system.codedom",
+        "@resources//system.configuration.configurationmanager",
+        "@resources//mono.cecil",
+    ],
+    defines = ["NET"],
+    allow_unsafe_blocks = True,
+)
diff --git a/src/Plugins/WiresharkPlugin/BUILD.bazel b/src/Plugins/WiresharkPlugin/BUILD.bazel
new file mode 100644
index 00000000..7c7ec440
--- /dev/null
+++ b/src/Plugins/WiresharkPlugin/BUILD.bazel
@@ -0,0 +1,62 @@
+load(
+    "@rules_dotnet//dotnet:defs.bzl",
+    "csharp_library",
+)
+
+package(default_visibility = ["//visibility:public"])
+
+csharp_library(
+    name = "WiresharkPlugin",
+    srcs = [
+     "BLESniffer.cs",
+     "INetworkLogExtensions.cs",
+     "LinkLayer.cs",
+     "Wireshark.cs",
+     "WiresharkPlugin.cs",
+     "WiresharkSender.cs",
+    ],
+    internals_visible_to = ["lib_wiresharkplugin"],
+    target_frameworks = ["net6.0"],
+    targeting_packs = [
+        "@rules_dotnet_nuget_packages//microsoft.netcore.app.ref",
+    ],
+    deps = [
+        "//src/Infrastructure/src/Emulator/Main:Emulator",
+        "//src/Infrastructure/src/Emulator/Extensions:Extensions",
+        "//lib/Migrant/Migrant:Migrant",
+        "//lib/ELFSharp/ELFSharp:ELFSharp",
+        "//lib/Packet.Net/PacketDotNet:PacketDotNet",
+        "//lib/CxxDemangler/CxxDemangler:CxxDemangler",
+        "//lib/AntShell/AntShell:AntShell",
+        "//lib/xwt/Xwt:Xwt",
+        "//lib/BigGustave/src/BigGustave:BigGustave",
+        "//lib/xwt/Xwt.Gtk:XwtGtk",
+        "//lib/termsharp:TermSharp",
+        "@renode-resources//:lucene",
+        "@renode-resources//:IronPython",
+        "@renode-resources//:IronPythonStdLib",
+        "@renode-resources//:IronPythonModules",
+        "@renode-resources//:MicrosoftScripting",
+        "@renode-resources//:MonoLinqExpressions",
+        "@renode-resources//:MonoTextTemplating",
+        "@renode-resources//:Dynamitey",
+        "@resources//system.drawing.common",
+        "@resources//gtksharp",
+        "@resources//atksharp",
+        "@resources//glibsharp",
+        "@resources//cairosharp",
+        "@resources//gdksharp",
+        "@resources//giosharp",
+        "@resources//pangosharp",
+        "@resources//mono.posix.netstandard",
+        "@resources//microsoft.codeanalysis.csharp",
+        "@resources//microsoft.codeanalysis.visualbasic",
+        "@resources//microsoft.codeanalysis.common",
+        "@resources//microsoft.codeanalysis.analyzers",
+        "@resources//system.codedom",
+        "@resources//system.configuration.configurationmanager",
+        "@resources//mono.cecil",
+    ],
+    defines = ["NET"],
+    allow_unsafe_blocks = True,
+)
2.42.0

