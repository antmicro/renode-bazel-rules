From 29c1407e19ec9b316316a15560e6033cdcc43824 Mon Sep 17 00:00:00 2001
From: Kamil Rakoczy <krakoczy@antmicro.com>
Date: Fri, 6 Oct 2023 09:45:32 +0200
Subject: [PATCH] Renode: Add BUILD.bazel

Signed-off-by: Kamil Rakoczy <krakoczy@antmicro.com>
---
 src/Plugins/VerilatorPlugin/BUILD.bazel |  72 +++++++++++
 src/Plugins/WiresharkPlugin/BUILD.bazel |  62 ++++++++++
 src/Renode/BUILD.bazel | 157 +++++++++++++++++++++++++++++++++++++++++
 6 files changed, 423 insertions(+)
 create mode 100644 src/Plugins/VerilatorPlugin/BUILD.bazel
 create mode 100644 src/Plugins/WiresharkPlugin/BUILD.bazel
 create mode 100644 src/Renode/BUILD.bazel

diff --git a/src/Plugins/VerilatorPlugin/BUILD.bazel b/src/Plugins/VerilatorPlugin/BUILD.bazel
new file mode 100644
index 00000000..c6cfbc92
--- /dev/null
+++ b/src/Plugins/VerilatorPlugin/BUILD.bazel
@@ -0,0 +1,72 @@
+load(
+    "@rules_dotnet//dotnet:defs.bzl",
+    "csharp_library",
+)
+
+package(default_visibility = ["//visibility:public"])
+
+csharp_library(
+    name = "VerilatorPlugin",
+    srcs = [
+     "Connection/IVerilatedPeripheral.cs",
+     "Connection/LibraryVerilatorConnection.cs",
+     "Connection/Protocols/ActionType.cs",
+     "Connection/Protocols/ProtocolMessage.cs",
+     "Connection/SocketVerilatorConnection.cs",
+     "Verilated/Peripherals/BaseDoubleWordVerilatedPeripheral.cs",
+     "Verilated/Peripherals/BaseVerilatedPeripheral.cs",
+     "Verilated/Peripherals/CFUVerilatedPeripheral.cs",
+     "Verilated/Peripherals/VerilatedCPU.cs",
+     "Verilated/Peripherals/VerilatedPeripheral.cs",
+     "Verilated/Peripherals/VerilatedRiscV32.cs",
+     "Verilated/Peripherals/VerilatedRiscV32Registers.cs",
+     "Verilated/Peripherals/VerilatedUART.cs",
+     "VerilatorPlugin.cs",
+    ],
+    internals_visible_to = ["lib_verilatorplugin"],
+    target_frameworks = ["net6.0"],
+    targeting_packs = [
+        "@rules_dotnet_nuget_packages//microsoft.netcore.app.ref",
+    ],
+    deps = [
+        "//src/Infrastructure/src/Emulator/Main:Emulator",
+        "//src/Infrastructure/src/Emulator/Extensions:Extensions",
+        "//src/Infrastructure/src/Emulator/Peripherals:Renode-peripherals",
+        "//src/Infrastructure/src/Emulator/Cores:cores-riscv",
+        "//lib/Migrant/Migrant:Migrant",
+        "//lib/ELFSharp/ELFSharp:ELFSharp",
+        "//lib/Packet.Net/PacketDotNet:PacketDotNet",
+        "//lib/CxxDemangler/CxxDemangler:CxxDemangler",
+        "//lib/AntShell/AntShell:AntShell",
+        "//lib/xwt/Xwt:Xwt",
+        "//lib/BigGustave/src/BigGustave:BigGustave",
+        "//lib/xwt/Xwt.Gtk:XwtGtk",
+        "//lib/termsharp:TermSharp",
+        "@renode-resources//:lucene",
+        "@renode-resources//:IronPython",
+        "@renode-resources//:IronPythonStdLib",
+        "@renode-resources//:IronPythonModules",
+        "@renode-resources//:MicrosoftScripting",
+        "@renode-resources//:MonoLinqExpressions",
+        "@renode-resources//:MonoTextTemplating",
+        "@renode-resources//:Dynamitey",
+        "@resources//system.drawing.common",
+        "@resources//gtksharp",
+        "@resources//atksharp",
+        "@resources//glibsharp",
+        "@resources//cairosharp",
+        "@resources//gdksharp",
+        "@resources//giosharp",
+        "@resources//pangosharp",
+        "@resources//mono.posix.netstandard",
+        "@resources//microsoft.codeanalysis.csharp",
+        "@resources//microsoft.codeanalysis.visualbasic",
+        "@resources//microsoft.codeanalysis.common",
+        "@resources//microsoft.codeanalysis.analyzers",
+        "@resources//system.codedom",
+        "@resources//system.configuration.configurationmanager",
+        "@resources//mono.cecil",
+    ],
+    defines = ["NET"],
+    allow_unsafe_blocks = True,
+)
diff --git a/src/Plugins/WiresharkPlugin/BUILD.bazel b/src/Plugins/WiresharkPlugin/BUILD.bazel
new file mode 100644
index 00000000..7c7ec440
--- /dev/null
+++ b/src/Plugins/WiresharkPlugin/BUILD.bazel
@@ -0,0 +1,62 @@
+load(
+    "@rules_dotnet//dotnet:defs.bzl",
+    "csharp_library",
+)
+
+package(default_visibility = ["//visibility:public"])
+
+csharp_library(
+    name = "WiresharkPlugin",
+    srcs = [
+     "BLESniffer.cs",
+     "INetworkLogExtensions.cs",
+     "LinkLayer.cs",
+     "Wireshark.cs",
+     "WiresharkPlugin.cs",
+     "WiresharkSender.cs",
+    ],
+    internals_visible_to = ["lib_wiresharkplugin"],
+    target_frameworks = ["net6.0"],
+    targeting_packs = [
+        "@rules_dotnet_nuget_packages//microsoft.netcore.app.ref",
+    ],
+    deps = [
+        "//src/Infrastructure/src/Emulator/Main:Emulator",
+        "//src/Infrastructure/src/Emulator/Extensions:Extensions",
+        "//lib/Migrant/Migrant:Migrant",
+        "//lib/ELFSharp/ELFSharp:ELFSharp",
+        "//lib/Packet.Net/PacketDotNet:PacketDotNet",
+        "//lib/CxxDemangler/CxxDemangler:CxxDemangler",
+        "//lib/AntShell/AntShell:AntShell",
+        "//lib/xwt/Xwt:Xwt",
+        "//lib/BigGustave/src/BigGustave:BigGustave",
+        "//lib/xwt/Xwt.Gtk:XwtGtk",
+        "//lib/termsharp:TermSharp",
+        "@renode-resources//:lucene",
+        "@renode-resources//:IronPython",
+        "@renode-resources//:IronPythonStdLib",
+        "@renode-resources//:IronPythonModules",
+        "@renode-resources//:MicrosoftScripting",
+        "@renode-resources//:MonoLinqExpressions",
+        "@renode-resources//:MonoTextTemplating",
+        "@renode-resources//:Dynamitey",
+        "@resources//system.drawing.common",
+        "@resources//gtksharp",
+        "@resources//atksharp",
+        "@resources//glibsharp",
+        "@resources//cairosharp",
+        "@resources//gdksharp",
+        "@resources//giosharp",
+        "@resources//pangosharp",
+        "@resources//mono.posix.netstandard",
+        "@resources//microsoft.codeanalysis.csharp",
+        "@resources//microsoft.codeanalysis.visualbasic",
+        "@resources//microsoft.codeanalysis.common",
+        "@resources//microsoft.codeanalysis.analyzers",
+        "@resources//system.codedom",
+        "@resources//system.configuration.configurationmanager",
+        "@resources//mono.cecil",
+    ],
+    defines = ["NET"],
+    allow_unsafe_blocks = True,
+)
diff --git a/src/Renode/BUILD.bazel b/src/Renode/BUILD.bazel
new file mode 100644
index 00000000..fccf1c09
--- /dev/null
+++ b/src/Renode/BUILD.bazel
@@ -0,0 +1,158 @@
+load(
+    "@rules_dotnet//dotnet:defs.bzl",
+    "csharp_binary",
+)
+package(default_visibility = ["//visibility:public"])
+csharp_binary(
+    name = "renode",
+    srcs = [
+      "Backends/Terminals/UartPtyTerminal.cs",
+      "Connectors/GPIOConnector.cs",
+      "EmulationEnvironment/EmulationEnvironment.cs",
+      "Integrations/ArduinoLoader.cs",
+      "Integrations/AsciinemaRecorder.cs",
+      "Network/NetworkServer/IServerModule.cs",
+      "Network/NetworkServer/Modules/TftpServerModule.cs",
+      "Network/NetworkServer/NetworkServer.cs",
+      "Network/RangeLossMediumFunction.cs",
+      "Network/RangeMediumFunction.cs",
+      "PlatformDescription/ConversionResult.cs",
+      "PlatformDescription/ConversionResultType.cs",
+      "PlatformDescription/CreationDriver.cs",
+      "PlatformDescription/DeclarationPlace.cs",
+      "PlatformDescription/FakeInitHandler.cs",
+      "PlatformDescription/IInitHandler.cs",
+      "PlatformDescription/IUsingResolver.cs",
+      "PlatformDescription/ParsingError.cs",
+      "PlatformDescription/ParsingException.cs",
+      "PlatformDescription/PreLexer.cs",
+      "PlatformDescription/SerializationProvider.cs",
+      "PlatformDescription/Syntax/Attribute.cs",
+      "PlatformDescription/Syntax/BoolValue.cs",
+      "PlatformDescription/Syntax/ConstructorOrPropertyAttribute.cs",
+      "PlatformDescription/Syntax/Description.cs",
+      "PlatformDescription/Syntax/EmptyValue.cs",
+      "PlatformDescription/Syntax/Entry.cs",
+      "PlatformDescription/Syntax/EnumValue.cs",
+      "PlatformDescription/Syntax/Grammar.cs",
+      "PlatformDescription/Syntax/IInitable.cs",
+      "PlatformDescription/Syntax/InitAttribute.cs",
+      "PlatformDescription/Syntax/IPrefixable.cs",
+      "PlatformDescription/Syntax/IrqAttribute.cs",
+      "PlatformDescription/Syntax/IrqDestinations.cs",
+      "PlatformDescription/Syntax/IrqEnd.cs",
+      "PlatformDescription/Syntax/IrqReceiver.cs",
+      "PlatformDescription/Syntax/ISimplestValue.cs",
+      "PlatformDescription/Syntax/IVisitable.cs",
+      "PlatformDescription/Syntax/IWithPosition.cs",
+      "PlatformDescription/Syntax/NumericalValue.cs",
+      "PlatformDescription/Syntax/ObjectValue.cs",
+      "PlatformDescription/Syntax/RangeValue.cs",
+      "PlatformDescription/Syntax/ReferenceValue.cs",
+      "PlatformDescription/Syntax/RegistrationInfo.cs",
+      "PlatformDescription/Syntax/SingleOrMultiIrqEnd.cs",
+      "PlatformDescription/Syntax/StringValue.cs",
+      "PlatformDescription/Syntax/StringWithPosition.cs",
+      "PlatformDescription/Syntax/SyntaxTreeHelpers.cs",
+      "PlatformDescription/Syntax/UsingEntry.cs",
+      "PlatformDescription/Syntax/Value.cs",
+      "PlatformDescription/UserInterface/MonitorInitHandler.cs",
+      "PlatformDescription/UserInterface/PlatformDescriptionMachineExtensions.cs",
+      "PlatformDescription/Variable.cs",
+      "PlatformDescription/VariableStore.cs",
+      "Program.cs",
+      #"Properties/AssemblyInfo.cs",
+      "RobotFrameworkEngine/CpuKeywords.cs",
+      "RobotFrameworkEngine/HelperExtensions.cs",
+      "RobotFrameworkEngine/HotSpotAction.cs",
+      "RobotFrameworkEngine/HttpServer.cs",
+      "RobotFrameworkEngine/IRobotFrameworkKeywordProvider.cs",
+      "RobotFrameworkEngine/Keyword.cs",
+      "RobotFrameworkEngine/KeywordException.cs",
+      "RobotFrameworkEngine/KeywordManager.cs",
+      "RobotFrameworkEngine/LedKeywords.cs",
+      "RobotFrameworkEngine/LogTester.cs",
+      "RobotFrameworkEngine/NetworkInterfaceKeywords.cs",
+      "RobotFrameworkEngine/Recorder.cs",
+      "RobotFrameworkEngine/RenodeKeywords.cs",
+      "RobotFrameworkEngine/RobotFrameworkEngine.cs",
+      "RobotFrameworkEngine/RobotFrameworkKeywordAttribute.cs",
+      "RobotFrameworkEngine/TestersProvider.cs",
+      "RobotFrameworkEngine/UartKeywords.cs",
+      "RobotFrameworkEngine/XmlRpcServer.cs",
+      "UI/LogoRow.cs",
+      "UI/TerminalActions.cs",
+      "UI/TerminalIOSource.cs",
+      "UI/TerminalWidget.cs",
+      "UI/TermsharpProvider.cs",
+    ],
+    internals_visible_to = ["//visibility:public"],
+    target_frameworks = ["net6.0"],
+    targeting_packs = [
+        "@rules_dotnet_nuget_packages//microsoft.netcore.app.ref",
+    ],
+    deps = [
+        "//src/Infrastructure/src/Emulator/Main:Emulator",
+        "//src/Infrastructure/src/Emulator/Extensions:Extensions",
+        "//src/Infrastructure/src/Emulator/Peripherals:Renode-peripherals",
+        "//src/Infrastructure/src/Emulator/Cores:cores-arm",
+        "//src/Infrastructure/src/Emulator/Cores:cores-arm-m",
+        "//src/Infrastructure/src/Emulator/Cores:cores-arm64",
+        "//src/Infrastructure/src/Emulator/Cores:cores-i386",
+        "//src/Infrastructure/src/Emulator/Cores:cores-ppc",
+        "//src/Infrastructure/src/Emulator/Cores:cores-ppc64",
+        "//src/Infrastructure/src/Emulator/Cores:cores-riscv",
+        "//src/Infrastructure/src/Emulator/Cores:cores-riscv64",
+        "//src/Infrastructure/src/Emulator/Cores:cores-sparc",
+        "//src/Infrastructure/src/Emulator/Cores:cores-xtensa",
+        "//src/Infrastructure/src/UI:UI",
+        "//src/Infrastructure/src/Plugins/AdvancedLoggerViewerPlugin:AdvancedLoggerViewerPlugin",
+        "//src/Infrastructure/src/Plugins/SampleCommandPlugin:SampleCommandPlugin",
+        "//src/Infrastructure/src/Plugins/TracePlugin:TracePlugin",
+        "//src/Plugins/VerilatorPlugin:VerilatorPlugin",
+        "//src/Plugins/WiresharkPlugin:WiresharkPlugin",
+        "//lib/Migrant/Migrant:Migrant",
+        "//lib/ELFSharp/ELFSharp:ELFSharp",
+        "//lib/Packet.Net/PacketDotNet:PacketDotNet",
+        "//lib/CxxDemangler/CxxDemangler:CxxDemangler",
+        "//lib/AntShell/AntShell:AntShell",
+        "//lib/xwt/Xwt:Xwt",
+        "//lib/BigGustave/src/BigGustave:BigGustave",
+        "//lib/xwt/Xwt.Gtk:XwtGtk",
+        "//lib/termsharp:TermSharp",
+        "//lib/InpliTftpServer/libtftp:libtftp",
+        "//lib/options-parser:OptionsParser",
+        "//lib/FdtSharp/FdtSharp:FdtSharp",
+        "//lib/bc-csharp/crypto:crypto",
+#        "@renode-resources//:IronPython",
+#        "@renode-resources//:IronPythonStdLib",
+#        "//:copy_styles_robot",
+        "@renode-resources//:MicrosoftScripting",
+        "@renode-resources//:MonoLinqExpressions",
+        "@renode-resources//:MonoTextTemplating",
+        "@renode-resources//:Dynamitey",
+        "@renode-resources//:Sprache",
+        "@renode-resources//:CookComputingXmlRpcV2",
+        "@renode-resources//:MicrosoftDynamic",
+        "@resources//system.drawing.common",
+        "@resources//gtksharp",
+        "@resources//atksharp",
+        "@resources//glibsharp",
+        "@resources//cairosharp",
+        "@resources//gdksharp",
+        "@resources//giosharp",
+        "@resources//pangosharp",
+        "@resources//mono.posix.netstandard",
+        "@resources//microsoft.codeanalysis.csharp",
+        "@resources//microsoft.codeanalysis.visualbasic",
+        "@resources//microsoft.codeanalysis.common",
+        "@resources//microsoft.codeanalysis.analyzers",
+        "@resources//system.codedom",
+        "@resources//system.configuration.configurationmanager",
+        "@resources//mono.cecil",
+        "@resources//ironpython",
+    ],
+    defines = ["NET"],
+    out = "Renode",
+    winexe = True,
+)
-- 
2.42.0

